<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>×ª×™××˜×¨×•×Ÿ ×ª×§×©×•×¨×ª - ××©×—×§ ××™× ×˜×¨××§×˜×™×‘×™</title>
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    /* ×©×™×œ×•×‘ ×”×¡×˜×™×™×œ ×”××˜×•×¨×£ ×©×œ CommQuest */
    body {
      font-family: 'Rubik', sans-serif;
      background-color: #f0f2f5;
      margin: 0;
      padding: 20px;
      direction: rtl;
      text-align: right;
      color: #333;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background-color: white;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      padding: 20px;
      position: relative;
      overflow: hidden;
    }
    .stage-header {
      text-align: center;
      background: linear-gradient(135deg, #8e44ad 0%, #673ab7 100%);
      color: white;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      font-weight: bold;
      font-size: 22px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    .xp-counter {
      position: absolute;
      top: 10px;
      right: 10px;
      background: linear-gradient(135deg, #FFC107 0%, #FF9800 100%);
      padding: 5px 10px;
      border-radius: 20px;
      color: white;
      font-weight: bold;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    .progress-bar {
      width: 100%;
      height: 20px;
      background-color: #e0e0e0;
      border-radius: 10px;
      margin-bottom: 20px;
      overflow: hidden;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.2);
    }
    .progress {
      height: 100%;
      background: linear-gradient(90deg, #8e44ad 0%, #9b59b6 100%);
      border-radius: 10px;
      width: 0%;
      transition: width 0.5s;
    }
    .game-area {
      padding: 20px;
      background-color: #f8faff;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: inset 0 1px 5px rgba(0,0,0,0.05);
      min-height: 300px;
      position: relative;
    }
    .scene {
      margin-bottom: 30px;
      display: none;
      animation: fadeIn 0.5s;
    }
    .scene.active {
      display: block;
    }
    .scene-header {
      font-size: 22px;
      font-weight: bold;
      color: white;
      background: linear-gradient(135deg, #8e44ad 0%, #673ab7 100%);
      padding: 10px;
      border-radius: 8px;
      text-align: center;
      margin-bottom: 15px;
    }
    .scene-info {
      background-color: #e8f4fc;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    .scene-character {
      font-weight: bold;
      margin-bottom: 5px;
      color: #2980b9;
    }
    .scene-text {
      font-size: 18px;
      margin-bottom: 10px;
      padding: 10px;
      background-color: #fff;
      border-left: 4px solid #3498db;
    }
    .expressions {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-around;
      margin: 20px 0;
    }
    .expression-option {
      cursor: pointer;
      width: 120px;
      text-align: center;
      margin: 10px;
      padding: 15px 10px;
      background: linear-gradient(135deg, #ff7b54 0%, #ff5722 100%);
      color: white;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      transition: all 0.3s;
      box-shadow: 0 3px 5px rgba(0,0,0,0.1);
    }
    .expression-option:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    .expression-option.selected {
      border-color: #3498db;
      border-width: 3px;
      background-color: #f0f8ff;
      color: #3498db;
    }
    .expression-emoji {
      font-size: 48px;
      margin-bottom: 10px;
    }
    .expression-label {
      font-size: 14px;
    }
    .feedback {
      display: none;
      padding: 15px;
      background-color: #f0f9ff;
      border-radius: 8px;
      margin-top: 20px;
      border-left: 4px solid #3498db;
      animation: fadeIn 0.5s;
    }
    .feedback-header {
      font-weight: bold;
      font-size: 18px;
      margin-bottom: 10px;
      color: #2980b9;
    }
    .buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
    }
    button {
      padding: 10px 20px;
      background: linear-gradient(135deg, #ff7b54 0%, #ff5722 100%);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.3s, transform 0.3s;
      box-shadow: 0 3px 5px rgba(0,0,0,0.1);
    }
    button:hover {
      background: linear-gradient(135deg, #ff5722 0%, #e64a19 100%);
      transform: translateY(-2px);
    }
    button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }
    .game-over {
      display: none;
      text-align: center;
      padding: 30px;
      background-color: #dff7ff;
      border-radius: 8px;
      margin: 20px 0;
    }
    .game-over h2 {
      color: #2c3e50;
      margin-bottom: 20px;
    }
    .score-info {
      font-size: 18px;
      margin: 15px 0;
    }
    .restart-btn {
      padding: 12px 25px;
      font-size: 18px;
      background: linear-gradient(135deg, #ff7b54 0%, #ff5722 100%);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 20px;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .panic-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: red;
      color: white;
      padding: 10px 15px;
      border-radius: 30px;
      font-weight: bold;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      animation: pulse 2s infinite;
      z-index: 100;
      cursor: pointer;
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    .tech-option {
      display: flex;
      flex-direction: column;
      align-items: center;
      background: white;
      padding: 15px;
      border-radius: 10px;
      margin: 10px;
      flex: 1;
      min-width: 120px;
      transition: all 0.3s;
      cursor: pointer;
      box-shadow: 0 3px 8px rgba(0,0,0,0.1);
    }
    .tech-option:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    .tech-option.selected {
      background: #e8d5f6;
      border: 2px solid #8e44ad;
    }
    .tech-icon {
      font-size: 30px;
      margin-bottom: 10px;
    }
    .tech-name {
      font-weight: bold;
      text-align: center;
    }
    .spy-question {
      background: #f5f5f5;
      border-left: 4px solid #9c27b0;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 5px;
      font-size: 18px;
    }
    .spy-option {
      display: block;
      width: 100%;
      padding: 12px 15px;
      margin: 10px 0;
      background: #ff7b54;
      color: white;
      border: none;
      border-radius: 8px;
      text-align: right;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .spy-option:hover {
      background: #ff5722;
      transform: translateY(-2px);
    }
    .spy-option.selected {
      background: #8e44ad;
    }
    .spy-feedback {
      background-color: #e8f5e9;
      border-left: 4px solid #4caf50;
      padding: 15px;
      margin: 15px 0;
      border-radius: 4px;
      font-weight: bold;
      display: none;
    }
    /* Stage 4 â€“ ××‘×—×Ÿ ×ª×§×©×•×¨×ª */
    #scene4 .comic-container {
      margin: 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="stage-header">
      <h1>×ª×™××˜×¨×•×Ÿ ×ª×§×©×•×¨×ª - ××©×—×§ ××™× ×˜×¨××§×˜×™×‘×™</h1>
    </div>
    
    <div class="xp-counter" id="xpCounter">XP: 0</div>
    
    <div class="progress-bar">
      <div class="progress" id="progress"></div>
    </div>
    
    <div class="game-area">
      <!-- ×¡×¦× ×” 1: ×¤×’×™×©×ª ×¢×‘×•×“×” -->
      <div class="scene active" id="scene1">
        <div class="scene-header">×¡×¦× ×” 1: ×¤×’×™×©×ª ×¢×‘×•×“×”</div>
        <div class="scene-info">
          <div class="scene-character">×“××•×ª: ×× ×”×œ ×¤×¨×•×™×§×˜</div>
          <div class="scene-text">"×”××¦×’×ª ×ª×”×™×” ××•×›× ×” ×‘×–××Ÿ, ×× ×™ ××‘×˜×™×—"</div>
        </div>
        <p>×‘×—×¨ ×”×‘×¢×ª ×¤× ×™× ×©×ª×©× ×” ××ª ×”××•×•×™×¨×” ××• ×”××¡×¨:</p>
        <div class="expressions">
          <div class="expression-option" onclick="selectExpression(1, 1)">
            <div class="expression-emoji">ğŸ˜</div>
            <div class="expression-label">×—×™×•×š ×¢×¨××•××™</div>
          </div>
          <div class="expression-option" onclick="selectExpression(1, 2)">
            <div class="expression-emoji">ğŸ˜³</div>
            <div class="expression-label">××‘×˜ ××•×¤×ª×¢</div>
          </div>
          <div class="expression-option" onclick="selectExpression(1, 3)">
            <div class="expression-emoji">ğŸ˜¬</div>
            <div class="expression-label">×—×™×•×š ×××•×œ×¥</div>
          </div>
          <div class="expression-option" onclick="selectExpression(1, 4)">
            <div class="expression-emoji">ğŸ¤”</div>
            <div class="expression-label">××‘×˜ ××”×•×¨×”×¨</div>
          </div>
        </div>
        <div class="feedback" id="feedback1"></div>
      </div>
      
      <!-- ×¡×¦× ×” 2: ××¡×™×‘×ª ×™×•× ×”×•×œ×“×ª -->
      <div class="scene" id="scene2">
        <div class="scene-header">×¡×¦× ×” 2: ××¡×™×‘×ª ×™×•× ×”×•×œ×“×ª</div>
        <div class="scene-info">
          <div class="scene-character">×“××•×ª: ×—×‘×¨ ×§×¨×•×‘</div>
          <div class="scene-text">"×•×•××•, ×œ× ×¦×™×¤×™×ª×™ ×œ××ª× ×” ×›×–××ª"</div>
        </div>
        <p>×‘×—×¨ ×”×‘×¢×ª ×¤× ×™× ×©×ª×©× ×” ××ª ×”××•×•×™×¨×” ××• ×”××¡×¨:</p>
        <div class="expressions">
          <div class="expression-option" onclick="selectExpression(2, 1)">
            <div class="expression-emoji">ğŸ˜</div>
            <div class="expression-label">×”×ª×œ×”×‘×•×ª</div>
          </div>
          <div class="expression-option" onclick="selectExpression(2, 2)">
            <div class="expression-emoji">ğŸ˜’</div>
            <div class="expression-label">××›×–×‘×” ××•×¡×ª×¨×ª</div>
          </div>
          <div class="expression-option" onclick="selectExpression(2, 3)">
            <div class="expression-emoji">ğŸ˜¯</div>
            <div class="expression-label">×”×¤×ª×¢×” ×××™×ª×™×ª</div>
          </div>
          <div class="expression-option" onclick="selectExpression(2, 4)">
            <div class="expression-emoji">ğŸ™„</div>
            <div class="expression-label">×—×•×¡×¨ ×¢× ×™×™×Ÿ</div>
          </div>
        </div>
        <div class="feedback" id="feedback2"></div>
      </div>
      
      <!-- ×¡×¦× ×” 3: ×¤×’×™×©×” ×¨××©×•× ×” -->
      <div class="scene" id="scene3">
        <div class="scene-header">×¡×¦× ×” 3: ×¤×’×™×©×” ×¨××©×•× ×”</div>
        <div class="scene-info">
          <div class="scene-character">×“××•×ª: ×‘×Ÿ/×‘×ª ×–×•×’ ×¤×•×˜× ×¦×™××œ×™</div>
          <div class="scene-text">"× ×—××“ ×œ×”×›×™×¨ ××•×ª×š, ×©××¢×ª×™ ×¢×œ×™×š ×”×¨×‘×” ×“×‘×¨×™×"</div>
        </div>
        <p>×‘×—×¨ ×”×‘×¢×ª ×¤× ×™× ×©×ª×©× ×” ××ª ×”××•×•×™×¨×” ××• ×”××¡×¨:</p>
        <div class="expressions">
          <div class="expression-option" onclick="selectExpression(3, 1)">
            <div class="expression-emoji">ğŸ˜Š</div>
            <div class="expression-label">×—×™×•×š ×—×</div>
          </div>
          <div class="expression-option" onclick="selectExpression(3, 2)">
            <div class="expression-emoji">ğŸ§</div>
            <div class="expression-label">××‘×˜ ×‘×•×—×Ÿ</div>
          </div>
          <div class="expression-option" onclick="selectExpression(3, 3)">
            <div class="expression-emoji">ğŸ˜</div>
            <div class="expression-label">×—×™×•×š ××ª×’×¨×”</div>
          </div>
          <div class="expression-option" onclick="selectExpression(3, 4)">
            <div class="expression-emoji">ğŸ˜³</div>
            <div class="expression-label">××‘×˜ × ×‘×•×š</div>
          </div>
        </div>
        <div class="feedback" id="feedback3"></div>
      </div>
      
      <!-- ×¡×¦× ×” 4: ×©×™×—×” ×¢× ××•×¨×” -->
      <div class="scene" id="scene4">
        <div class="scene-header">×¡×¦× ×” 4: ×©×™×—×” ×¢× ××•×¨×”</div>
        <div class="scene-info">
          <div class="scene-character">×“××•×ª: ××•×¨×”</div>
          <div class="scene-text">"×™×© ×œ× ×• ×”×¨×‘×” ××” ×œ×“×‘×¨ ×¢×œ ×”×¢×‘×•×“×” ×”××—×¨×•× ×” ×©×œ×š"</div>
        </div>
        <p>×‘×—×¨ ×”×‘×¢×ª ×¤× ×™× ×©×ª×©× ×” ××ª ×”××•×•×™×¨×” ××• ×”××¡×¨:</p>
        <div class="expressions">
          <div class="expression-option" onclick="selectExpression(4, 1)">
            <div class="expression-emoji">ğŸ™‚</div>
            <div class="expression-label">×—×™×•×š ×§×œ</div>
          </div>
          <div class="expression-option" onclick="selectExpression(4, 2)">
            <div class="expression-emoji">ğŸ˜ </div>
            <div class="expression-label">×›×¢×¡</div>
          </div>
          <div class="expression-option" onclick="selectExpression(4, 3)">
            <div class="expression-emoji">ğŸ¤¨</div>
            <div class="expression-label">×¡×¤×§× ×•×ª</div>
          </div>
          <div class="expression-option" onclick="selectExpression(4, 4)">
            <div class="expression-emoji">ğŸ˜°</div>
            <div class="expression-label">×—×¨×“×”</div>
          </div>
        </div>
        <div class="feedback" id="feedback4"></div>
      </div>
      
      <!-- ×¡×¦× ×” 5: ×¨××™×•×Ÿ ×¢×‘×•×“×” -->
      <div class="scene" id="scene5">
        <div class="scene-header">×¡×¦× ×” 5: ×¨××™×•×Ÿ ×¢×‘×•×“×”</div>
        <div class="scene-info">
          <div class="scene-character">×“××•×ª: ××¨××™×™×Ÿ</div>
          <div class="scene-text">"×¡×¤×¨ ×œ×™ ×§×¦×ª ×¢×œ ×”×—×•×œ×©×•×ª ×©×œ×š"</div>
        </div>
        <p>×‘×—×¨ ×”×‘×¢×ª ×¤× ×™× ×©×ª×©× ×” ××ª ×”××•×•×™×¨×” ××• ×”××¡×¨:</p>
        <div class="expressions">
          <div class="expression-option" onclick="selectExpression(5, 1)">
            <div class="expression-emoji">ğŸ˜ƒ</div>
            <div class="expression-label">×—×™×•×š ×¨×—×‘</div>
          </div>
          <div class="expression-option" onclick="selectExpression(5, 2)">
            <div class="expression-emoji">ğŸ˜‘</div>
            <div class="expression-label">×¤× ×™× ×—×ª×•××•×ª</div>
          </div>
          <div class="expression-option" onclick="selectExpression(5, 3)">
            <div class="expression-emoji">ğŸ¤”</div>
            <div class="expression-label">×¡×§×¨× ×•×ª</div>
          </div>
          <div class="expression-option" onclick="selectExpression(5, 4)">
            <div class="expression-emoji">ğŸ˜</div>
            <div class="expression-label">×—×™×•×š ×¢×¨××•××™</div>
          </div>
        </div>
        <div class="feedback" id="feedback5"></div>
      </div>
      
      <!-- ×›×¤×ª×•×¨ PANIC -->
      <div class="panic-btn" onclick="panicMode()">PANIC!</div>
      
      <!-- ×›×¤×ª×•×¨ "×”×¨×•×¡ ××ª ×”×¢×•×œ×" -->
      <button class="btn" onclick="destroyGame()" style="position: fixed; bottom: 80px; right: 20px; background: darkred;">×”×¨×•×¡ ××ª ×”×¢×•×œ×</button>
    </div>
    
    <div class="buttons">
      <button id="prevBtn" onclick="prevScene()" disabled>×”×§×•×“×</button>
      <button id="nextBtn" onclick="nextScene()" disabled>×”×‘×</button>
    </div>
  </div>
  
  <!-- Audio Elements -->
  <audio id="backgroundMusic" src="epic-background-music-313043.mp3" loop></audio>
  <audio id="explosionSound" src="my-first-recorded-explosion-103816.mp3"></audio>
  <audio id="panicSound" src="man-screaming-259682.mp3"></audio>
  <audio id="missionSuccessSound" src="mission-success-41211.mp3"></audio>
  <audio id="transitionSound" src="cartoon-fail-trumpet-278822.mp3"></audio>
  
  <script>
    // ×”×¤×¢×œ×ª ××•×–×™×§×ª ×¨×§×¢ ×‘×¨××” ×©×œ 30% ×¢× ×××–×™×Ÿ ×œ×”×‘×˜×™×— ×”×©××¢×” ×‘×¢×ª ××™× ×˜×¨××§×¦×™×”
    const bgMusic = document.getElementById('backgroundMusic');
    bgMusic.volume = 0.3;
    bgMusic.play().catch(err => console.error(err));
    document.addEventListener('click', function() {
      if (bgMusic.paused) {
        bgMusic.play().catch(err => console.error(err));
      }
    });
    
    // ××©×ª× ×™× ×’×œ×•×‘×œ×™×™×
    let currentScene = 1;
    const totalScenes = 5;
    let score = 0;
    let selectedOptions = {};
    let gameState = { persona: "", mood: "", currentSpyQuestion: 0 };
    
    // ×ª×’×•×‘×•×ª ××•×ª×××•×ª ××™×©×™×ª ×œ×›×œ ×¡×¦× ×”
    const feedbackData = {
      1: {
        1: { text: "×”×—×™×•×š ×”×¢×¨××•××™ ××©× ×” ××ª ×”××¡×¨ ×œ×—×œ×•×˜×™×Ÿ! ×¢×›×©×™×• × ×¨××” ×›××™×œ×• ×× ×”×œ ×”×¤×¨×•×™×§×˜ ×™×•×“×¢ ××©×”×• ×©×”×•× ×œ× ××¡×¤×¨, ××• ×©×™×© ×œ×• ×ª×•×›× ×™×ª × ×¡×ª×¨×ª. ××•×•×™×¨×” ×©×œ ×—×•×¡×¨ ×××™× ×•×ª.", isGood: false },
        2: { text: "×”××‘×˜ ×”××•×¤×ª×¢ ×”×•×¤×š ××ª ×”×”×‘×˜×—×” ×œ××•×–×¨×” â€“ ×›××™×œ×• ××¤×™×œ×• ×× ×”×œ ×”×¤×¨×•×™×§×˜ ×¢×¦××• ××•×¤×ª×¢ ×©×”××¦×’×ª ×ª×”×™×” ××•×›× ×” ×‘×–××Ÿ! ××¤×§×˜ ×§×•××™ ×©××—×œ×™×© ××ª ×”×××™× ×•×ª.", isGood: true },
        3: { text: "×”×—×™×•×š ×”×××•×œ×¥ ××©×“×¨ ×œ×—×¥ ×•×—×•×¡×¨ ×‘×™×˜×—×•×Ÿ â€“ ××ª××™× ×× ××ª× ×¨×•×¦×™× ×œ×”×¨××•×ª ×©×”××¦×’×ª ×›× ×¨××” ×ª×ª×¢×›×‘.", isGood: true },
        4: { text: "×”××‘×˜ ×”××”×•×¨×”×¨ ××¦×‘×™×¢ ×¢×œ ×›×š ×©×× ×”×œ ×”×¤×¨×•×™×§×˜ ×¢×¦××• ×œ× ×‘×˜×•×—, ×•×–×” ×‘×”×—×œ×˜ ××•×¨×™×“ ××”×‘×˜×—×ª×•.", isGood: true }
      },
      2: {
        1: { text: "×”×ª×œ×”×‘×•×ª ×©××“×‘×™×§×” â€“ ×”××¡×¨ ×¢×•×‘×¨ ×›××™×œ×• ×”××ª× ×” ×”×™×™×ª×” ××¢×‘×¨ ×œ×—×œ×•××•×ª.", isGood: true },
        2: { text: "××›×–×‘×” ××•×¡×ª×¨×ª ×©××©×“×¨×ª ×©×¡×•×“ ×”××ª× ×” ×”×•× ×‘×¢×¦× ×—×™×¡×¨×•×Ÿ ××¡×•×™× â€“ ××¡×¨ ×œ× ×‘×¨×•×¨.", isGood: true },
        3: { text: "×”×¤×ª×¢×” ×××™×ª×™×ª ×©××“×‘×¨×ª ×‘×¢×“ ×¢×¦××” â€“ ×›× ×¨××” ×”×—×‘×¨ ×œ× ×”×¨×’×™×© ××ª ×–×” ×›×›×” ×§×•×“×.", isGood: true },
        4: { text: "×—×•×¡×¨ ×¢× ×™×™×Ÿ ×©××‘×™× ×¡×ª×™×¨×” ×‘×™×Ÿ ×”××™×œ×™× ×œ×¨×’×©×•×ª â€“ ×××© ×˜×¨×•×œ, ××‘×œ ×œ× ×‘××•×‘×Ÿ ×”××’× ×™×‘.", isGood: false }
      },
      3: {
        1: { text: "×—×™×•×š ×—× ×©××–××™×Ÿ ×œ×§×©×¨ â€“ ×¤×©×•×˜ ××•×©×œ× ×œ×¤×ª×™×—×ª ××¤×’×©.", isGood: true },
        2: { text: "××‘×˜ ×‘×•×—×Ÿ ×©××¢×œ×” ××ª ×¨××ª ×”××ª×— â€“ ×™×›×•×œ ×œ×”×™×•×ª ×§×¦×ª ×™×•×ª×¨ ××“×™ ×× ××ª× ×× ×¡×™× ×œ×”×¨×’×™×¢ ××ª ×”××•×•×™×¨×”.", isGood: true },
        3: { text: "×—×™×•×š ××ª×’×¨×” ×©××¢×‘×™×¨ ×¨××–×™× ×©×œ ×¡×•×“×™×•×ª ×•××¡×ª×•×¨×™×Ÿ â€“ ××ª×— ×¨×•×× ×˜×™ ××ª×¤×ª×—.", isGood: true },
        4: { text: "××‘×˜ × ×‘×•×š ×©××•×¡×™×£ × ×•×¤×š ×©×œ ×—×•×¡×¨ ×‘×™×˜×—×•×Ÿ â€“ ×¢×©×•×™ ×œ×”×™×•×ª ××¢× ×™×™×Ÿ, ××š ×œ× ×ª××™×“ ××ª××™×.", isGood: true }
      },
      4: {
        1: { text: "×—×™×•×š ×§×œ ×©××¢× ×™×§ ××•×•×™×¨×” ×©×œ ×¢×™×“×•×“ â€“ ×”××•×¨×” ××¨×’×™×©×” ×©××ª× ×¢×œ ××•×ª×• ×’×œ.", isGood: true },
        2: { text: "×›×¢×¡ ×©××‘×™× ××ª ×”××¡×¨ ×œ×’×•×‘×” â€“ ×”××•×¨×” ×œ× ××¨×•×¦×” ×•××ª× ×¢×œ×•×œ×™× ×œ×§×‘×œ ×‘×™×§×•×¨×ª, ××‘×œ ×œ×¤×—×•×ª ××ª× ×›× ×™×.", isGood: true },
        3: { text: "×¡×¤×§× ×•×ª ×©××¢×•×¨×¨×ª ×—×©×“ â€“ ××•×œ×™ ×”××•×¨×” ××ª×—×™×œ×” ×œ×—×§×•×¨ ×™×•×ª×¨ ××“×™.", isGood: true },
        4: { text: "×—×¨×“×” ×©××¦×™×’×” ××ª ×”××•×¨×” ×›×©××™× ×” ×™×•×“×¢×ª ××™×š ×œ×”×’×™×‘ â€“ ×¤×—×•×ª ××•××œ×¥.", isGood: false }
      },
      5: {
        1: { text: "×—×™×•×š ×¨×—×‘ ×©××©×“×¨ ×× ×¨×’×™×” ×—×™×•×‘×™×ª â€“ ×”××¨××™×™×Ÿ ×™×¨×’×™×© ×©××ª× ×‘×˜×•×—×™× ×‘×¢×¦××›×.", isGood: true },
        2: { text: "×¤× ×™× ×—×ª×•××•×ª ×©××§×¨×™× ×•×ª ×§×•×©×™ ×•×”×ª× ×’×“×•×ª â€“ ×¤×—×•×ª ×¡×‘×™×¨ ×©×™×§×‘×œ×• ××ª×›×.", isGood: false },
        3: { text: "×¡×§×¨× ×•×ª ×©××¢×‘×™×¨×” ×¢× ×™×™×Ÿ ×××™×ª×™ â€“ ×”××¨××™×™×Ÿ ×¤×ª×•×— ×œ×©××•×¢ ××” ×™×© ×œ×›× ×œ×•××¨.", isGood: true },
        4: { text: "×—×™×•×š ×¢×¨××•××™ ×©××¢×œ×” ××ª ×¨××ª ×”××ª×— â€“ ×× ××ª× ××ª×›× × ×™× ××©×—×§ ×©×œ ×¤×¡×™×›×•×œ×•×’×™×”, ×–×” ×™×›×•×œ ×œ×¢×‘×•×“, ××š ×–×” ××¡×•×›×Ÿ.", isGood: true }
      }
    };
    
    function updateProgressBar() {
      const progress = ((currentScene - 1) / totalScenes) * 100;
      document.getElementById('progress').style.width = progress + '%';
    }
    
    function updateXP(points) {
      score += points; // ×× ×• ××©×ª××©×™× ×‘× ×™×§×•×“ ×’× ×›-XP
      document.getElementById('xpCounter').textContent = `XP: ${score}`;
      document.getElementById('xpCounter').style.transform = 'scale(1.2)';
      setTimeout(() => {
        document.getElementById('xpCounter').style.transform = 'scale(1)';
      }, 300);
    }
    
    // ×¤×•× ×§×¦×™×” ×œ×˜×™×¤×•×œ ×‘×‘×—×™×¨×ª ×”×‘×¢×ª ×¤× ×™× (×¢× ×ª×’×•×‘×•×ª ××•×ª×××•×ª ××™×©×™×ª)
    function selectExpression(scene, option) {
      selectedOptions[scene] = option;
      const feedback = feedbackData[scene][option];
      const feedbackElement = document.getElementById(`feedback${scene}`);
      
      if (feedback.isGood) { updateXP(10); }
      
      feedbackElement.innerHTML = `<div class="feedback-header">×”××©×•×‘ ×©×œ×š:</div><p>${feedback.text}</p>`;
      feedbackElement.style.display = 'block';
      
      // ××¤×©×•×¨ ×›×¤×ª×•×¨ "×”×‘×"
      document.getElementById('nextBtn').disabled = false;
      
      // × ×˜×¨×•×œ ××¤×©×¨×•×™×•×ª ×•×”×“×’×©×ª ×”× ×‘×—×¨×ª
      const options = document.querySelectorAll(`#scene${scene} .expression-option`);
      options.forEach((opt, index) => {
        opt.style.cursor = 'default';
        opt.onclick = null;
        if (index === option - 1) {
          opt.classList.add('selected');
        }
      });
    }
    
    function nextScene() {
      if (currentScene < totalScenes) {
        document.getElementById(`scene${currentScene}`).classList.remove('active');
        currentScene++;
        document.getElementById(`scene${currentScene}`).classList.add('active');
        document.getElementById('prevBtn').disabled = (currentScene === 1);
        document.getElementById('nextBtn').disabled = !selectedOptions[currentScene];
        updateProgressBar();
      } else {
        // ×‘×¡×™×•× ×”×©××œ×” ×”××—×¨×•× ×”, ××¢×‘×¨ ××•×˜×•××˜×™ ×œ-body.html
        goToBody();
      }
    }
    
    function prevScene() {
      if (currentScene > 1) {
        document.getElementById(`scene${currentScene}`).classList.remove('active');
        currentScene--;
        document.getElementById(`scene${currentScene}`).classList.add('active');
        document.getElementById('prevBtn').disabled = (currentScene === 1);
        document.getElementById('nextBtn').disabled = !selectedOptions[currentScene];
        updateProgressBar();
      }
    }
    
    function selectPersona(persona) {
      document.querySelectorAll('.persona-box').forEach(box => {
        box.classList.remove('selected');
      });
      document.getElementById('persona-' + persona).classList.add('selected');
      gameState.persona = persona;
      checkPersonaComplete();
    }
    
    function selectMood(mood) {
      document.querySelectorAll('.mood-option').forEach(box => {
        box.classList.remove('selected');
      });
      document.getElementById('mood-' + mood).classList.add('selected');
      gameState.mood = mood;
      checkPersonaComplete();
    }
    
    function checkPersonaComplete() {
      if (gameState.persona && gameState.mood) {
        document.getElementById('nextBtnP').disabled = false;
      }
    }
    
    function setupScene0() {
      let personaResponse = "";
      switch(gameState.persona) {
        case "comedian":
          personaResponse = "××– ×× ×™ ×¦×¨×™×š ×œ×”×¦×™×œ ××ª ×”×¢×•×œ×? ××™ ×§×‘×¢ ×©×× ×™ ×œ× ×¤×©×•×˜ ××¡×¤×¡×•×£ ×¢×œ ×”×¡×¤×” ×•××¦×¤×” ×‘×¡×“×¨×•×ª ×›×•×©×œ×•×ª? ğŸ¿";
          break;
        case "cool":
          personaResponse = "×§×œ×˜×ª×™ ××ª ×”×¢× ×™×™×Ÿ... ×‘×•× × ×¢×©×” ××ª ×–×” ××’× ×™×‘, ×’× ×× ×”×¢×ª×™×“ × ×¨××” ×›××• ×§×¨×§×¡ ××ª×¤×•×¨×¨. ğŸ•¶ï¸";
          break;
        case "smart":
          personaResponse = "×—×©×‘×ª×™ ×¢×œ ×–×”, ×•×¤×ª×¨×ª×™ ××ª ×”×‘×¢×™×” ×œ×¤× ×™ ×©×”××•×— ×©×œ×™ ×”×ª×—×™×œ ×œ×”×™×–×¨×§. ×§×“×™××”, × ×ª×—×™×œ ××ª ×”× ×™×ª×•×—! ğŸ”¬";
          break;
        case "robot":
          personaResponse = "×§×•×œ×˜. ×¡×¨×™×§×”... × ×™×ª×•×— ×ª×§×©×•×¨×ª×™ ××ª×—×™×œ ×‘×¢×•×“ 3, 2, 1... ğŸ¤–";
          break;
      }
      document.getElementById('personaResponse').textContent = personaResponse;
    }
    
    function setupScene1() {
      // ×“×•×’××” ×¤×©×•×˜×” ×œ×¡×¦× ×” 1
      document.getElementById('scenarioText').textContent = "×—×ª×•×œ ×§×•×¤×¥ ×¢×œ ×©×•×œ×—×Ÿ ×•×¦×•×¢×§ ×¢×œ ×‘×•×¨×§×¡ ×—×.";
      document.getElementById('scenarioImage').textContent = "ğŸ˜¾ğŸ•";
      const optionsContainer = document.getElementById('emotionOptions');
      optionsContainer.innerHTML = '';
      ["×©××—×”", "×¨×¢×‘", "×¤×—×“", "×›×¢×¡"].forEach(option => {
        const btn = document.createElement('button');
        btn.classList.add('option');
        btn.textContent = option;
        btn.addEventListener('click', () => selectEmotion(1, option === "×¨×¢×‘" ? 2 : 1)); 
        // ×‘×“×•×’××”: ×”×ª×©×•×‘×” ×”× ×›×•× ×” ×”×™× "×¨×¢×‘" (×›×¤×ª×•×¨ 2) 
        optionsContainer.appendChild(btn);
      });
      document.getElementById('emotionFeedback').style.display = 'none';
      document.getElementById('nextBtn').disabled = true;
      selectedOptions[1] = null;
    }
    
    function setupScene2() {
      const scenarios = [
        "×¨×—×¤× ×™× ××¢×‘×™×¨×™× ××¡×¨×™×, ×•×”××•×¨×™× ×œ×•××“×™× ××™×š ×œ×¨×§×•×“ ×‘×¡× ×›×¨×•×Ÿ.",
        "×©×™×¢×•×¨×™ VR: ×¢×›×©×™×• ××¤×©×¨ ×œ×”×™×•×ª ×‘×›×™×ª×” ×•×œ×”×¨×’×™×© ×›××™×œ×• ××ª×” ×‘×××ª ×‘×•×“×“ ×‘××¦×™××•×ª ××“×•××”.",
        "××•×—-×¢× ×Ÿ: ×—×©×‘×• ×¢×œ ×–×” ×›××• ×¢×œ ×˜×•×•×™×˜×¨, ×¨×§ ×¢× ×¤×—×•×ª ××™×œ×™× ×•×™×•×ª×¨ ××—×©×‘×•×ª ×¢××•×§×•×ª."
      ];
      const scenario = scenarios[Math.floor(Math.random() * scenarios.length)];
      document.getElementById('futureText').textContent = scenario;
      document.getElementById('techChat').style.display = 'none';
      document.getElementById('nextBtn').disabled = true;
      selectedOptions[2] = null;
    }
    
    function selectTechOption(option) {
      document.querySelectorAll('.tech-option').forEach(opt => {
        opt.classList.remove('selected');
        opt.disabled = true;
      });
      document.getElementById('tech-' + option).classList.add('selected');
      let response = "";
      switch(gameState.persona) {
        case "comedian":
          response = "ğŸ¤ª ××—×œ×” ×‘×—×™×¨×”! ×’× ×”×¢×ª×™×“ ×œ× ×™×›×•×œ ×œ×¢××•×“ ××•×œ ×‘×“×™×—×” ×˜×•×‘×”.";
          break;
        case "cool":
          response = "ğŸ˜ ×‘×—×™×¨×” ××’× ×™×‘×”. ×”×¢×ª×™×“ ×›×‘×¨ × ×¨××” ×”×¨×‘×” ×™×•×ª×¨ ×§×•×œ.";
          break;
        case "smart":
          response = "ğŸ§  × ×™×ª×•×— ××”×™×¨: ×”×‘×—×™×¨×” ×©×œ×š ×ª×ª×¨×•× ×œ××•×¤×˜×™××™×–×¦×™×” ×©×œ ×”×ª×§×©×•×¨×ª ×”×¢×ª×™×“× ×™×ª.";
          break;
        case "robot":
          response = "ğŸ¤– × ×ª×•× ×™× ××¢×•×‘×“×™×: ×‘×—×™×¨×” ××•×¤×˜×™××œ×™×ª ×œ×”×¢×‘×¨×ª ××—×©×‘×•×ª ×œ×œ× ×”×¤×¨×¢×•×ª.";
          break;
      }
      document.getElementById('techChat').textContent = response;
      document.getElementById('techChat').style.display = 'block';
      updateXP(10);
      document.getElementById('nextBtn').disabled = false;
      selectedOptions[2] = option;
    }
    
    let spyQuestions = [
      {
        text: "××™×©×”×• × ×™×¡×” ×œ×©×œ×•×— ×”×•×“×¢×” ×¡×•×“×™×ª ×‘×××¦×¢ ×”×©×™×¢×•×¨, ××” ×ª×’×™×‘?",
        options: ["×©×ª×™×§×”", "×¨×¢×© ×¨×§×¢", "×©××œ×” ××¦×—×™×§×”", "××‘×˜ ×—×©××™"],
        correct: "××‘×˜ ×—×©××™"
      },
      {
        text: "×›×™×¦×“ ××¢×‘×™×¨×™× ××™×“×¢ ×‘×œ×™ ××™×œ×™×?",
        options: ["×ª× ×•×¢×”", "×¢×™× ×™×™×", "×—×™×•×š", "××—×™××•×ª ×›×¤×™×™×"],
        correct: "×¢×™× ×™×™×"
      },
      {
        text: "××™×š ×ª×’×™×‘ ×›×©××™×©×”×• × ×•×“×¢ ×œ×š ×¡×•×“ ×©××¡×•×¨ ×œ×©××•×¢?",
        options: ["×¦×—×•×§", "×”×¡×ª×¨×”", "×”×ª×¢×œ××•×ª", "×”×ª×¤×¨×¦×•×ª"],
        correct: "×”×ª×¢×œ××•×ª"
      }
    ];
    
    function setupScene3() {
      gameState.currentSpyQuestion = 0;
      loadSpyQuestion();
      document.getElementById('spyFeedback').style.display = 'none';
      document.getElementById('nextBtn').disabled = true;
      selectedOptions[3] = null;
    }
    
    function loadSpyQuestion() {
      const question = spyQuestions[gameState.currentSpyQuestion];
      document.getElementById('spyQuestion').textContent = question.text;
      const optionsContainer = document.getElementById('spyOptions');
      optionsContainer.innerHTML = '';
      question.options.forEach(option => {
        const btn = document.createElement('button');
        btn.classList.add('spy-option');
        btn.textContent = option;
        btn.addEventListener('click', () => selectSpyAnswer(option, question.correct));
        optionsContainer.appendChild(btn);
      });
      document.getElementById('spyFeedback').style.display = 'none';
    }
    
    function selectSpyAnswer(selected, correct) {
      const feedbackEl = document.getElementById('spyFeedback');
      const isCorrect = selected === correct;
      document.querySelectorAll('#spyOptions .spy-option').forEach(opt => {
        if (opt.textContent === selected) {
          opt.classList.add('selected');
        } else {
          opt.disabled = true;
        }
      });
      if (isCorrect) {
        feedbackEl.innerHTML = `<p>ğŸ‘ × ×›×•×Ÿ! ×–×• ×”×™×™×ª×” ×”×‘×—×™×¨×” ×”× ×›×•× ×”.</p>`;
        document.getElementById('missionSuccessSound').play();
        updateXP(10);
      } else {
        feedbackEl.innerHTML = `<p>ğŸ˜’ ×˜×¢×•×ª! ×œ× ×ª××™×“ ×”×“×‘×¨×™× ×–×•×¨××™× ×›××• ×©×¦×™×¤×™×ª.</p>`;
        document.getElementById('transitionSound').play();
      }
      feedbackEl.style.display = 'block';
      if (gameState.currentSpyQuestion < spyQuestions.length - 1) {
        document.getElementById('nextBtn').disabled = false;
      } else {
        document.getElementById('nextBtn').disabled = false;
      }
      selectedOptions[3] = selected;
    }
    
    let quizQuestions = [
      {
        text: "×ª×§×©×•×¨×ª ×–×” ×œ× ×¨×§ ××™×œ×™×. ××” ×™×•×ª×¨ ×—×©×•×‘ ×œ×“×¢×ª ×œ×§×¨×•×?",
        options: ["×”×‘×¢×•×ª ×¤× ×™×", "×¡×™×× ×™ ×’×•×£", "××™×™×œ×™×", "×¨××–×™× ×¡×ª×•××™×"],
        correct: "×¨××–×™× ×¡×ª×•××™×"
      },
      {
        text: "×›×©××™×©×”×• ××•××¨ '×‘×•× × ×“×‘×¨ ×¢×œ ×–×”', ××” ×–×” ×‘×××ª ××•××¨?",
        options: ["×”×›×œ ×‘×¡×“×¨", "×ª×ª×›×•× ×Ÿ ×œ×”×¨×¤×ª×§×”", "×™×© ×‘×¢×™×”", "×ª××©×™×š ×œ×‘×œ×•×ª"],
        correct: "×™×© ×‘×¢×™×”"
      },
      {
        text: "××™×š ××’×™×‘ ×”×§×•××™×§××™ ×›×©× ×œ×—×¥ ×œ×—×¥ ×ª×§×©×•×¨×ª×™?",
        options: ["×¢× ×‘×“×™×—×”", "×¢× ×©×ª×™×§×”", "×¢× ×¦×¢×§×”", "×¢× ×¨×™×§×•×“ ××˜×•×¨×£"],
        correct: "×¢× ×‘×“×™×—×”"
      }
    ];
    let currentQuizIndex = 0;
    
    function setupScene4() {
      currentQuizIndex = 0;
      loadQuizQuestion();
      document.getElementById('quizFeedback').style.display = 'none';
      document.getElementById('nextBtn').disabled = true;
      selectedOptions[4] = null;
    }
    
    function loadQuizQuestion() {
      const question = quizQuestions[currentQuizIndex];
      document.getElementById('quizQuestion').textContent = question.text;
      const optionsContainer = document.getElementById('quizOptions');
      optionsContainer.innerHTML = '';
      question.options.forEach(option => {
        const btn = document.createElement('button');
        btn.classList.add('option');
        btn.textContent = option;
        btn.addEventListener('click', () => selectQuizAnswer(option, question.correct));
        optionsContainer.appendChild(btn);
      });
    }
    
    function selectQuizAnswer(selected, correct) {
      const feedbackEl = document.getElementById('quizFeedback');
      const isCorrect = selected === correct;
      document.querySelectorAll('#quizOptions .option').forEach(opt => {
        if (opt.textContent === selected) {
          opt.classList.add('selected');
        } else {
          opt.disabled = true;
        }
      });
      if (isCorrect) {
        feedbackEl.innerHTML = `<p>ğŸ‘ × ×›×•×Ÿ! × ×¨××” ×©×™×© ×‘×š ××ª ×”××•×— ×”×ª×§×©×•×¨×ª×™ ×©×œ ×“×•×¨ ×”×‘×.</p>`;
        document.getElementById('missionSuccessSound').play();
        updateXP(10);
      } else {
        feedbackEl.innerHTML = `<p>ğŸ˜’ ×˜×¢×•×ª! ××•×œ×™ ×›×“××™ ×œ×”××–×™×Ÿ ×œ×—×“×©×•×ª ×‘××§×•× ×œ× ×¡×•×ª ×œ×”×‘×™×Ÿ ××ª ×”×§×•×“ ×©×œ ×”×—×™×™×.</p>`;
        document.getElementById('transitionSound').play();
      }
      feedbackEl.style.display = 'block';
      document.getElementById('nextBtn').disabled = false;
      selectedOptions[4] = selected;
    }
    
    function nextQuizQuestion() {
      currentQuizIndex++;
      if (currentQuizIndex < quizQuestions.length) {
        loadQuizQuestion();
        document.getElementById('quizFeedback').style.display = 'none';
        document.getElementById('nextBtn').disabled = true;
      } else {
        // ×‘×¡×™×•× ×”×©××œ×” ×”××—×¨×•× ×”, ××¢×‘×¨ ××•×˜×•××˜×™ ×œ-body.html
        goToBody();
      }
    }
    
    function panicMode() {
      document.getElementById('panicSound').play();
      alert("PANIC MODE ACTIVATED â€“ ××• ×¤×©×•×˜ ×ª×©×ª×” ×§×¤×” ×•×ª××©×™×š, ×”×—×™×™× ×§×¦×¨×™× ××“×™!");
    }
    
    function destroyGame() {
      const overlay = document.createElement('div');
      overlay.id = 'destroyOverlay';
      overlay.style.position = 'fixed';
      overlay.style.top = '0';
      overlay.style.left = '0';
      overlay.style.width = '100%';
      overlay.style.height = '100%';
      overlay.style.backgroundColor = 'black';
      overlay.style.opacity = '0.9';
      overlay.style.color = 'red';
      overlay.style.display = 'flex';
      overlay.style.justifyContent = 'center';
      overlay.style.alignItems = 'center';
      overlay.style.fontSize = '36px';
      overlay.style.zIndex = '9999';
      overlay.innerHTML = "×”×¨×¡×ª ××ª ×”×¢×•×œ×!";
      document.body.appendChild(overlay);
      
      document.getElementById('explosionSound').play();
      
      setTimeout(() => {
        document.body.removeChild(overlay);
      }, 3000);
    }
    
    function goToBody() {
      document.getElementById('transitionSound').play();
      setTimeout(() => {
        window.location.href = "body.html";
      }, 1500);
    }
    
    window.onload = function() {
      bgMusic.play().catch(err => console.error(err));
    }
    
    function restartGame() {
      currentScene = 1;
      score = 0;
      selectedOptions = {};
      gameState = { persona: "", mood: "", currentSpyQuestion: 0 };
      
      document.querySelectorAll('.persona-box, .mood-option').forEach(box => {
        box.classList.remove('selected');
      });
      document.getElementById('nextBtnP').disabled = true;
      
      for (let i = 1; i <= totalScenes; i++) {
        const sceneEl = document.getElementById(`scene${i}`);
        sceneEl.classList.remove('active');
        const options = document.querySelectorAll(`#scene${i} .expression-option, #scene${i} .option, #scene${i} .spy-option`);
        options.forEach((opt, index) => {
          opt.style.cursor = 'pointer';
          opt.classList.remove('selected');
          opt.onclick = function() { 
            // ×™×© ×œ×”×’×“×™×¨ ××ª ×”××™×¨×•×¢ ×‘×”×ª×× ×œ×¡×¦× ×”: ×›××Ÿ ×× ×• ×× ×™×—×™× ×©×”×¤×•× ×§×¦×™×•×ª ×”××§×•×¨×™×•×ª ××—×¨××™×•×ª ×œ××™×¨×•×¢×™×
          };
        });
        const feedbackEl = document.getElementById(`feedback${i}`);
        if (feedbackEl) feedbackEl.style.display = 'none';
      }
      
      document.getElementById('scene1').classList.add('active');
      document.getElementById('gameOver').style.display = 'none';
      
      document.getElementById('prevBtn').disabled = true;
      document.getElementById('nextBtn').disabled = true;
      
      updateProgressBar();
    }
  </script>
</body>
</html>
